#include "config.h"

CC = gcc
XCOMM CDEBUGFLAGS = -g -Wall
XCOMM CCOPTIONS = 

XCOMM
XCOMM	do not touch below
XCOMM

XHISHODIR = $(LIBDIR)/xhisho
LOCALEDIR = $(LIBDIR)/$(LANG)/app-defaults

#ifdef HAVE_LIBXPG4
LIB_XPG4 = -lxpg4
#endif

#ifdef HAVE_LIBNSL
LIB_NSL = -lnsl
DSP_FILE = "/dev/audio"
#endif

#ifdef HAVE_LIBSOCKET
LIB_SOCKET = -lsocket
#endif

LIB_SOLARIS = $(LIB_SOCKET) $(LIB_NSL)

#ifdef WITH_XPM
LIB_XPM = -lXpm 
#endif

#ifdef PERSONAL
BINDIR	= $(HOME)/bin/
XHISHODIR = $(HOME)/xhisho/
LOCALEDIR = $(HOME)/$(LANG)/app-defaults
#endif

#ifdef EXT_FILTER
FILTER = -DEXT_FILTER
#endif

#ifdef PETNAME
PET = -DPETNAME
#endif

#ifdef USE_SOUND
SOUND = -DUSE_SOUND
#endif

#ifdef USE_YOUBIN
YOUBIN = -DYOUBIN
#endif

#ifdef USE_POP
#undef USE_YOUBIN
YOUBIN =
POP = -DPOP
#endif

#ifdef USE_APOP
#undef USE_YOUBIN
YOUBIN =
POP = -DAPOP -DPOP
#endif

#ifdef ABOOK
ADD = -DADDRESSBOOK -DPETNAME
#endif


DEFINES = $(FILTER) $(PET) $(SOUND) $(YOUBIN) $(POP) $(ADD)

EXTRA_LIBRARIES = $(LIB_XPM) $(LIB_XPG4) $(LIB_SOLARIS)

DEPLIBS = XawClientDepLibs
LOCAL_LIBRARIES = XawClientLibs

BASE_OBJS =  mail.o main.o Msgwin.o XHisho.o about.o editor.o schedule.o calendar.o menu.o ResEdit.o load_bmp.o message.o

#ifdef USE_SOUND
SOUND_OBJS = sound.o
#endif

#ifdef USE_POP
POP_OBJS = pop.o
#endif

#ifdef USE_APOP
POP_OBJS = pop.o md5c.o
#endif

#ifdef PETNAME
PETNAME_OBJS = petname.o
#endif

OBJS = $(BASE_OBJS) $(SOUND_OBJS) $(POP_OBJS) $(PETNAME_OBJS)
SRCS = $(OBJS:.o=.c)

#ifdef AKARI
ComplexProgramTarget(xakari)
#else
ComplexProgramTarget(xhisho)
#endif


#ifdef I18N
all:: XHisho.ad XHisho.jp
#else
all:: XHisho.ad
#endif

#ifdef AKARI
XHisho.ad:: XAkari.ad.sed
	sed 's!XHISHODIR!$(XHISHODIR)!' XAkari.ad.sed  >$@
#else
XHisho.ad:: XHisho.ad.sed
	sed 's!XHISHODIR!$(XHISHODIR)!' XHisho.ad.sed >$@
#endif

#ifdef I18N
XHisho.jp:: XHisho.jp.sed
	sed 's!XHISHODIR!$(XHISHODIR)!' XHisho.jp.sed >$@
#endif



#ifdef AKARI
sample/Messages.akari:: sample/Messages.akari.sed
	sed 's!XHISHODIR!$(XHISHODIR)!' sample/Messages.akari.sed | sed 's!YOUR_NAME!$(YOUR_NAME)!' >$@

clean:: 
	$(RM) XHisho.ad sample/Messages.akari
#endif

clean:: 
	$(RM) XHisho.ad

MakeDirectories(install,$(XHISHODIR))

#ifdef I18N
MakeDirectories(install,$(LOCALEDIR))
#endif

#ifdef PERSONAL
InstallNonExec(XHisho.ad,$(HOME)/XHisho)
#else
InstallAppDefaults(XHisho)
#endif

#ifdef I18N
InstallNonExec(XHisho.jp,$(LOCALEDIR)/XHisho)
#endif

#ifdef I18N
InstallNonExec(sample/aisatu.cfg,$(XHISHODIR))
InstallNonExec(sample/xhs.weekly.jp,$(XHISHODIR)/xhs.weekly)
InstallNonExec(sample/Messages.jp,$(XHISHODIR)/Messages)
InstallNonExec(sample/xhs.holiday,$(XHISHODIR)/xhs.holiday)
#else
InstallNonExec(sample/xhs.weekly,$(XHISHODIR))
InstallNonExec(sample/Messages,$(XHISHODIR))
InstallNonExec(sample/greeting.cfg,$(XHISHODIR))
#endif

InstallNonExec(sample/Petname,$(XHISHODIR))

#ifdef USE_SOUND
InstallNonExec(sample/newmail.wav,$(XHISHODIR))
InstallNonExec(sample/schedule.wav,$(XHISHODIR))
#endif

#ifdef AKARI
InstallNonExec(sample/aisatu.cfg.akari,$(XHISHODIR)/xhs.aisatu.cfg)
InstallNonExec(sample/akari.bmp,$(XHISHODIR))
InstallNonExec(sample/Messages.akari,$(XHISHODIR)/Messages)
#else
InstallNonExec(sample/hisho.bmp,$(XHISHODIR))
#endif
