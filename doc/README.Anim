	*******************************************
	 XHisho アニメーション定義ファイル 解説
	   *******************************************

XHishoでは、背景画像としてアニメーション定義ファイルを指定することがで
きます。これにより、アニメーション画像を背景に指定することができます。

1. フォーマット

  基本的には、単純なテキストファイルになります。

  1行目は、アニメーション定義ファイルであることを示す文字列 "XHisho
  Animation File" だけから成ります。

  2行目以降は、アニメーションコマンドからなります。アニメーションコマ
  ンドは
   
    1)実際にアニメーションに使う画像ファイル名と、表示時間(0.1秒単位)
    2)GOTO文(後述)
    3)MAIL及びSCHEDULEラベル(後述)

  のいずれかです。



2. GOTO文

  GOTOを使った、制御文らしきものが書けます。書式は

  GOTO 行き先 回数

  です。行き先には、アニメーション定義コマンドの行数を指定します。回数
  は省略もしくは -1 で無制限になります。
  定義コマンドの行数は、1から数えます。最初の1行「XHisho Animation
  File」およびコメントアウトは数えません。




3. ラベル

  MAIL、SCHEDULEの2つのラベルが使えます。ラベルはそれだけで1行使います。
  このラベルをつけると、メール到着時(スケジュール通知時)に、このラベル
  の次の行からアニメーションが実行されます。

  ラベルの直前などにGOTOを入れるのを忘れないでください。そうしないと、
  ラベルを無視してアニメーションが先に進んでしまいます。

  なお、通知ウインドをPopdownすると、それまでの通常アニメーションの続
  きに復帰します。



4. 実例

  例えば、「1.bmpを0.5秒、2.bmpを0.3秒、3.bmpを1秒、4.bmpを0.1秒」とい
  う順にアニメーションさせたい場合、定義ファイルは以下のようになります。

XHisho Animation File
1.bmp 5
2.bmp 3
3.bmp 10
4.bmp 1


  2つ目のフィールドの秒数を省略すると、1だと見なされます。


  先ほどと同じアニメーションで、「2.bmpを0.3秒、3.bmpを1秒」というシー
  ケンスを3回繰り返し、そのあとで4.bmpを表示したい場合は以下のようにな
  ります。

XHisho Animation File
1.bmp 5
2.bmp 3
3.bmp 10
GOTO 2 3
4.bmp 1


  次に、ラベルを使う場合です。「通常は1.bmp、メールが来たら2.bmp、スケ
  ジュール通知時は3.bmpを表示」の場合は次のようになります。

XHisho Animation File
1.bmp 5
GOTO 0
MAIL
2.bmp 5
GOTO 3
SCHEDULE
3.bmp 5
GOTO 6

  この時、GOTOを忘れるとそのまま1.bmp → 2.bmp → 3.bmpと表示されてし
  まいますので気をつけてください。例えば最後の行の「GOTO 6」を忘れると、
  スケジュール通知時に3.bmpを表示したあと、続けて1.bmpを表示してしまい
  ます。



5. ファイル名の検索

  3行目以降のファイル名は、以下のルールで検索されます。

  (1)絶対パスとしてファイルを探す。無ければ次へ。
  (2)カレントディレクトリを探す。無ければ次へ。
  (3)アニメーション定義ファイルと同じディレクトリを探す。無ければエラー。



6. 制限事項


  (1)当然ながら、アニメーションに使うファイルが多いほどメモリを食いま
     す。あまり多いと起動できないことがあります。
  (2)1枚の画像を表示するのに時間がかかる場合(Ex. 大きな画像、複雑な
     shape、計算機が遅い)、定義ファイルの記述通りにならないことがあり
     ます。
  (3)GOTO文は記述しにくい上にエラーチェックもいい加減ですので、注意し
     て使ってください。これは、今後の拡張のための仕様と考えてください。
     将来的な野望としては、もう少し分かりやすい制御構文を備えたコンパ
     イラらしきものを作ろうかと考えています。
  (4)LABELを使うとき、GOTOを記述するのを忘れないでください。また、GOTO
     の行き先(行番号)を間違えると、たぶんひどいことになります ^^;

