

 ******************************************************************
   XHisho と 「あれ以外の何かwith任意」 について
 ******************************************************************


1. 「あれ以外の何かwith任意」とは？

詳細略(笑)
「Xでもまゆらに会いたい〜」という人向けです。




2. コンパイル

configureのオプションで、

%./configure --with-option

とすると、「あれ以外の何かwith任意」対応になります。
さらに、

%./configure --with-option --with-unyuu

とすると、うにゅうにも対応しますが、まゆらでしか試してませんので変な動
きをするかもしれません。

さらに、外部コマンドに頼らずに「華和梨」を使う場合は

%./configure --with-option --with-unyuu --with-kawari

としてください。もしくは、

%./configure --enable-mayura

でも一緒です :-)




3. 動作原理

実は、「あれ以外の何かwith任意」にnativeに対応してません(手抜き)。
XHishoは外部コマンドとして適当なコマンドを動かします。そのコマンドが以
下の条件を満していれば、そのメッセージを表示可能なだけです。

・適当なタイミングでメッセージを標準出力に出す
・メッセージに(Surface:n)という出力があれば、CGをn番に変更する
・\eを含んだメッセージを出力すると、次の出力を表示する前にふきだしの中
  をクリアする。

つまり、「shiori.dll + αをやって、メッセージを出力するコンソールアプ
リ」があればいいことになります。もちろん、適当なものを作れば「あれ以外
の何かwith任意」以外の色々なものに対応できる可能性を秘めてます。


但し、shiori.dllとして、Merister氏が作られている「華和梨」を使う場合は
この限りではありません。configureのオプションに「--with-kawari」を指定
することで、nativeに対応します。但し、コンパイルにはgcc-2.9x以降が必要
だと思います。

オリジナルのshiori.dllなどを使うゴーストに関しては未対応です。だれかが
んばってコンソールアプリを作ってください ^^;






4. じゃあ何を使えばいいの?

外部コマンドには、Merister氏が作られている「華和梨」と「非A for
Linux/Wine」(*1)が使えます。
というか、この「非A」を元に作りましたんで ^^;

「Wineが動かないよ〜」という人のために、gcc-2.9x以降であればnativeにコ
ンパイルできるように修正を施したものもあります。

もしくは、configureのオプションに「--with-kawari」を指定して、nativeに
「華和梨」を使うこともできます。



(*1)
http://meister-d-i.hoops.ne.jp/





5. 使い方

起動時に、-optioncmd オプションで外部コマンドを指定します。例えば

%xhisho -optioncmd /usr/local/bin/nisesakura

などとします。ふきだしの大きさは -optionwidth と -optionheightで指定可
能です。
で、はっきり言ってしまうとまゆらでしか試してません。まゆらを使うときは
アニメーションファイルにまゆらのSurfaceを並べて記述し、

%xhisho -optioncmd /usr/local/bin/nisesakura -cgfile mayura.anim \
        -shape -noclock

とかやるとそれっぽくなります。うにゅうを使うときは、うにゅうのCGは12行
目以降に書いてください(11行目まではさくらのsurfaceかダミーのファイル名
を記述。ただし、ダミーのファイルもCGファイルの必要あり)。サンプルとし
て、sample/mayura.anim を置いてますのでこれをsurfaceのCGのあるディレク
トリに置いてください。


ふきだしの位置が気にくわないときは-xoff オプションと -yoff オプション
で適当に調整してください。わたしが試した感じだと

%xhisho -optioncmd /usr/local/bin/nisesakura -cgfile mayura.anim \
        -shape -noclock -xoff '-70' -yoff 10

くらいがいい感じです。
ふきだしは、右/中/左クリックいずれでも閉じます。ふきだしの上の適当なと
ころでクリックしてください。


以下に、with任意のカスタムに役立つオプションを列挙します。これらを適当
に組み合わせてください。対応するリソースも列挙しますので、毎回起動オプ
ションに指定するのが面倒な場合はリソースファイルで設定してください。




・-xoff             : ふきだしの位置補正(x方向)
  (リソース: XHisho*option*xoff)

・-yoff             : ふきだしの位置補正(y方向)
  (リソース: XHisho*option*yoff)

・-optionwidth      : "任意"のふきだしの幅
  (リソース: XHisho*OptionWindow*optionWidth)

・-optionheight     : "任意"のふきだしの高さ
  (リソース: XHisho*OptionWindow*optionHeight)

・-uxoff            : うにゅうのふきだしの位置補正(x方向)
  (リソース: XHisho*uXOffset)

・-uyoff            : うにゅうのふきだしの位置補正(y方向)
  (リソース: XHisho*uYOffset)

・-uwidth           : うにゅうのふきだしの幅
  (リソース: XHisho*UOptionWindow*optionWidth)

・-uheight          : うにゅうのふきだしの高さ
  (リソース: XHisho*UOptionWindow*optionHeight)

・-ucgoff           : うにゅうのCGの位置補正(x方向)
  (リソース: XHisho*uCGoff)

・-optiontimeout    : "任意"のふきだしの自動Popdownまでの時間
  (リソース: XHisho*optionTimeout)

・-wait             : "任意"のメッセージのウエイト
  (リソース: XHisho*messageWait)

・-nogreeting       : 起動時に挨拶を出さない

・kwait             : 「華和梨」のメッセージ頻度(秒単位)
  (リソース: XHisho*kawariWait) 

・kawaridir         : 「華和梨」の辞書のあるディレクトリ
  (リソース: XHisho*kawariDir) 




6. 制限事項

・結構メモリを食います。
・外部コマンドが不意に死ぬとひどいことになります。XHishoを再起動してく
  ださい。
・さくらのメッセージは行頭が「sakura:」で、うにゅうのメッセージは
  行頭が「unyuu:」でないとダメです。
・さくらのCG変更メッセージは「sakura:(Surface:n)」で、うにゅうのCG変更
  メッセージは「unyuu:(Surface:n)」のみです。
・選択肢を選ぶことはできません。
・メッセージに「$」が含まれると困ります。
・まゆらのおしゃべりにはSJISの機種依存文字が含まれてます。これらは、
  「＃」に置き換えられます。たまに失敗して表示が崩れるかも知れません。
・たまに表示が変でも笑って許してください。




7. Copyright

ディレクトリ kawari 以下のファイルの、以下のものについてはMeister氏
(meister@24h.co.jp)が原作者です。

	base64.cpp
	base64.h
	kawari.cpp
	kawari.h
	kawari_crypt.cpp
	kawari_crypt.h

これらはMeister氏のライセンスに従い、XHishoと共に再配布する場合は「原
作者表示を残したままで」BSDライセンスとします。その他のものについては、
XHishoのライセンスに従います。




8. 謝辞


「華和梨」の作者のMeisterさん。そもそも「華和梨」が無ければこの機能は
実現できませんでした。また、再配布を快く承諾して頂きありがとうございま
した。



